<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Laberinto con persecución</title>
<style>
  body { margin: 0; display: flex; justify-content: center; align-items: center; flex-direction: column; background: #ddd; height: 100vh; }
  canvas { background: #fff; display: block; margin-bottom: 10px; }
  .buttons { display: flex; justify-content: center; gap: 10px; flex-wrap: wrap; }
  .buttons button { padding: 10px 15px; font-size: 18px; }
</style>
</head>
<body>

<canvas id="game" width="400" height="400"></canvas>
<input type="file" id="playerImgInput" accept="image/*">
<input type="file" id="chaserImgInput" accept="image/*">

<div class="buttons">
  <button onclick="movePlayer('up')">↑</button>
  <button onclick="movePlayer('left')">←</button>
  <button onclick="movePlayer('down')">↓</button>
  <button onclick="movePlayer('right')">→</button>
</div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const CELL_SIZE = 40;
const ROWS = canvas.height / CELL_SIZE;
const COLS = canvas.width / CELL_SIZE;

let playerImg = new Image();
let chaserImg = new Image();

let playerPos = {x:0, y:0};
let chaserPos = {x:ROWS-1, y:COLS-1};

// Laberinto
let maze = [];
for(let r=0;r<ROWS;r++){
  maze[r] = [];
  for(let c=0;c<COLS;c++){
    maze[r][c] = Math.random() > 0.2 ? 0 : 1;
  }
}
maze[0][0] = 0; // Asegurar salida inicial
maze[ROWS-1][COLS-1] = 0; // Asegurar salida del perseguidor

// Cargar imágenes
document.getElementById('playerImgInput').addEventListener('change', function(e){
  playerImg.src = URL.createObjectURL(e.target.files[0]);
});
document.getElementById('chaserImgInput').addEventListener('change', function(e){
  chaserImg.src = URL.createObjectURL(e.target.files[0]);
});

// Dibujar laberinto y personajes
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      ctx.fillStyle = maze[r][c]===1 ? 'black' : 'white';
      ctx.fillRect(c*CELL_SIZE,r*CELL_SIZE,CELL_SIZE,CELL_SIZE);
      ctx.strokeStyle = 'gray';
      ctx.strokeRect(c*CELL_SIZE,r*CELL_SIZE,CELL_SIZE,CELL_SIZE);
    }
  }
  ctx.drawImage(playerImg, playerPos.y*CELL_SIZE, playerPos.x*CELL_SIZE, CELL_SIZE, CELL_SIZE);
  ctx.drawImage(chaserImg, chaserPos.y*CELL_SIZE, chaserPos.x*CELL_SIZE, CELL_SIZE, CELL_SIZE);
}

// Movimiento jugador con teclado
document.addEventListener('keydown', function(e){
  if(e.key === 'ArrowLeft') movePlayer('left');
  if(e.key === 'ArrowRight') movePlayer('right');
  if(e.key === 'ArrowUp') movePlayer('up');
  if(e.key === 'ArrowDown') movePlayer('down');
});

// Movimiento jugador con botones táctiles
function movePlayer(dir){
  let {x,y} = playerPos;
  if(dir==='up' && x>0 && maze[x-1][y]===0) playerPos.x--;
  if(dir==='down' && x<ROWS-1 && maze[x+1][y]===0) playerPos.x++;
  if(dir==='left' && y>0 && maze[x][y-1]===0) playerPos.y--;
  if(dir==='right' && y<COLS-1 && maze[x][y+1]===0) playerPos.y++;
}

// Movimiento del perseguidor
function moveChaser(){
  let dx = playerPos.x - chaserPos.x;
  let dy = playerPos.y - chaserPos.y;

  if(Math.abs(dx) > Math.abs(dy)){
    if(dx>0 && maze[chaserPos.x+1][chaserPos.y]===0) chaserPos.x++;
    else if(dx<0 && maze[chaserPos.x-1][chaserPos.y]===0) chaserPos.x--;
  } else {
    if(dy>0 && maze[chaserPos.x][chaserPos.y+1]===0) chaserPos.y++;
    else if(dy<0 && maze[chaserPos.x][chaserPos.y-1]===0) chaserPos.y--;
  }
}

function gameLoop(){
  moveChaser();
  draw();
  if(playerPos.x === chaserPos.x && playerPos.y === chaserPos.y){
    alert("¡Has sido atrapado!");
    playerPos = {x:0, y:0};
    chaserPos = {x:ROWS-1, y:COLS-1};
  }
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
